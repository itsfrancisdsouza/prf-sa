<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Transaction</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and general body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5; /* Lighter gray, closer to Material Design background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2.5rem; /* Increased padding for more spacious feel */
        }
        /* Specific styling for the header with a clean, flat blue */
        .header-bg {
            background-color: #4285F4; /* Google Blue */
            color: white;
            border-radius: 0.5rem 0.5rem 0 0; /* Slightly less rounded top corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle shadow for header */
        }
        /* Input and select field styling with clean focus and minimal shadow */
        input[type="text"],
        input[type="date"],
        select {
            @apply p-3.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200; /* Clean border, subtle ring on focus */
            box-shadow: none; /* Removed inner shadow for a flatter look */
        }
        input[type="text"]:focus,
        input[type="date"]:focus,
        select:focus {
            border-color: #4285F4; /* Google Blue border on focus */
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2); /* Soft blue glow on focus */
        }
        /* Checkbox styling */
        input[type="checkbox"] {
            @apply h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer;
        }
        /* Button styling for a clean, materialistic look with pill shape */
        button {
            @apply px-7 py-3 rounded-full font-medium transition-all duration-200; /* Increased horizontal padding, more vertical padding, and full rounded corners */
            letter-spacing: 0.01em; /* Less spaced letters */
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1); /* Very subtle shadow */
            transform: translateY(0); /* Ensure no default transform */
            &:hover {
                transform: translateY(-0.5px); /* Very subtle lift on hover */
                box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15); /* Slightly more pronounced shadow on hover */
            }
            &:active {
                transform: translateY(0); /* Press down effect */
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            }
        }
        .btn-clear {
            @apply bg-gray-100 text-gray-700 border border-gray-300 hover:bg-gray-200; /* Light gray with border */
        }
        .btn-save {
            background-color: #4285F4; /* Google Blue */
            @apply text-white hover:bg-blue-600; /* Darker blue on hover */
        }
        /* Required field asterisk styling */
        .required-label::after {
            content: '*';
            color: #ea4335; /* Google Red for asterisk */
            margin-left: 0.25rem;
        }
        /* Main container styling */
        .form-container {
            @apply bg-white shadow-lg rounded-lg; /* Softer, more consistent shadow */
            max-width: 50rem; /* Slightly wider form */
            width: 100%;
            border: 1px solid #e0e0e0; /* Very light border */
        }
        /* Message Box styling */
        #messageBox {
            @apply mt-8 p-4 rounded-lg text-center font-medium text-base; /* Standard size, clean look */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08); /* Subtle shadow */
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-8 form-container">
        <!-- Header Section -->
        <div class="header-bg p-6 mb-10 text-center">
            <h1 class="text-3xl font-bold tracking-normal">New Transaction</h1>
        </div>

        <!-- Form Section -->
        <form id="transactionForm" class="grid grid-cols-1 md:grid-cols-2 gap-x-10 gap-y-8">
            <!-- Type - Checkboxes will be handled by custom validation for at least one selected -->
            <div class="md:col-span-2 flex items-center mb-4">
                <label class="block text-gray-700 text-lg font-bold mr-6 required-label">Type</label>
                <div class="flex items-center mr-10">
                    <input type="checkbox" id="payments" name="type" value="Payments" class="mr-2">
                    <label for="payments" class="text-gray-700 text-base font-medium">PAYMENTS</label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="refunds" name="type" value="Refunds" class="mr-2">
                    <label for="refunds" class="text-gray-700 text-base font-medium">REFUNDS</label>
                </div>
            </div>

            <!-- Student ID -->
            <div>
                <label for="studentId" class="block text-gray-700 text-sm font-bold mb-2 required-label">Student ID</label>
                <input type="text" id="studentId" name="studentId" class="w-full" required>
            </div>

            <!-- Student Name -->
            <div>
                <label for="studentName" class="block text-gray-700 text-sm font-bold mb-2 required-label">Student Name</label>
                <input type="text" id="studentName" name="studentName" class="w-full" required>
            </div>

            <!-- Amount -->
            <div>
                <label for="amount" class="block text-gray-700 text-sm font-bold mb-2 required-label">Amount</label>
                <input type="text" id="amount" name="amount" class="w-full" required>
            </div>

            <!-- Mode of Payment -->
            <div>
                <label for="modeOfPayment" class="block text-gray-700 text-sm font-bold mb-2 required-label">Mode Of Payment</label>
                <select id="modeOfPayment" name="modeOfPayment" class="w-full" required>
                    <option value="">Select Mode</option>
                    <option value="Cash">Cash</option>
                    <option value="Online Transfer">Online Transfer</option>
                    <option value="Card">Card</option>
                    <option value="Cheque">Cheque</option>
                    <option value="UPI">UPI</option>
                </select>
            </div>

            <!-- Payment Type -->
            <div>
                <label for="paymentType" class="block text-gray-700 text-sm font-bold mb-2 required-label">Payment Type</label>
                <select id="paymentType" name="paymentType" class="w-full" required>
                    <option value="">Select Payment Type</option>
                    <option value="Token Amount">Token Amount</option>
                    <option value="First Instalment">First Instalment</option>
                    <option value="Part Instalment">Part Instalment</option>
                    <option value="Full Payment">Full Payment</option>
                </select>
            </div>

            <!-- Tx ID -->
            <div>
                <label for="txId" class="block text-gray-700 text-sm font-bold mb-2 required-label">Tx ID</label>
                <input type="text" id="txId" name="txId" class="w-full" required>
            </div>

            <!-- Course Name -->
            <div>
                <label for="courseName" class="block text-gray-700 text-sm font-bold mb-2 required-label">Course Name</label>
                <input type="text" id="courseName" name="courseName" class="w-full" required>
            </div>

            <!-- Batch No. -->
            <div>
                <label for="batchNo" class="block text-gray-700 text-sm font-bold mb-2 required-label">Batch No.</label>
                <input type="text" id="batchNo" name="batchNo" class="w-full" required>
            </div>

            <!-- Date of Payment -->
            <div>
                <label for="dateOfPayment" class="block text-gray-700 text-sm font-bold mb-2 required-label">Date Of Payment</label>
                <input type="date" id="dateOfPayment" name="dateOfPayment" class="w-full" required>
            </div>

            <!-- Note -->
            <div>
                <label for="note" class="block text-gray-700 text-sm font-bold mb-2 required-label">Note</label>
                <input type="text" id="note" name="note" class="w-full" required>
            </div>

            <!-- Buttons -->
            <div class="md:col-span-2 flex justify-end space-x-4 mt-10">
                <button type="button" id="clearButton" class="btn-clear">Clear</button>
                <button type="submit" id="saveButton" class="btn-save">Save</button>
            </div>
        </form>

        <!-- Message Box for feedback -->
        <div id="messageBox" class="hidden mt-6 p-4 rounded-lg text-center font-medium" role="alert"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('transactionForm');
            const clearButton = document.getElementById('clearButton');
            const messageBox = document.getElementById('messageBox');
            const paymentsCheckbox = document.getElementById('payments');
            const refundsCheckbox = document.getElementById('refunds');

            // IMPORTANT: This has been updated with your deployed Google Apps Script Web App URL
            const GOOGLE_APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzjQ9vYDF9n-qbbjVn0FcBY7UjY-Rs0mHXRfqRGNaTBPzCSoevnnr77Cba_yLim8rCr/exec';

            // Function to show a message
            function showMessage(message, type = 'success') {
                messageBox.textContent = message;
                messageBox.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
                if (type === 'success') {
                    messageBox.classList.add('bg-green-100', 'text-green-800');
                } else {
                    messageBox.classList.add('bg-red-100', 'text-red-800');
                }
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                }, 5000); // Hide after 5 seconds
            }

            // Handle checkbox exclusivity
            paymentsCheckbox.addEventListener('change', () => {
                if (paymentsCheckbox.checked) {
                    refundsCheckbox.checked = false;
                }
            });

            refundsCheckbox.addEventListener('change', () => {
                if (refundsCheckbox.checked) {
                    paymentsCheckbox.checked = false;
                }
            });

            // Handle form submission
            form.addEventListener('submit', async (e) => {
                e.preventDefault(); // Prevent default form submission

                // Custom validation for at least one checkbox selected
                if (!paymentsCheckbox.checked && !refundsCheckbox.checked) {
                    showMessage('Please select either PAYMENTS or REFUNDS.', 'error');
                    return;
                }

                // Collect form data
                const formData = new FormData(form);
                const data = {};
                for (let [key, value] of formData.entries()) {
                    // Handle checkboxes - only include the checked one
                    if (key === 'type') {
                        if (paymentsCheckbox.checked) {
                            data[key] = paymentsCheckbox.value;
                        } else if (refundsCheckbox.checked) {
                            data[key] = refundsCheckbox.value;
                        } else {
                            data[key] = ''; // No type selected
                        }
                    } else {
                        data[key] = value;
                    }
                }

                // Ensure 'type' is correctly set if neither is checked
                if (!data.type) {
                    data.type = ''; // Default to empty if no type is selected
                }

                // Remove duplicate 'type' entries if both were submitted by FormData (though handled above)
                delete data['type']; // Remove the generic 'type' entry
                if (paymentsCheckbox.checked) {
                    data['type'] = paymentsCheckbox.value;
                } else if (refundsCheckbox.checked) {
                    data['type'] = refundsCheckbox.value;
                } else {
                    data['type'] = '';
                }

                // Show a loading message or disable the button
                document.getElementById('saveButton').textContent = 'Saving...';
                document.getElementById('saveButton').disabled = true;

                try {
                    const response = await fetch(GOOGLE_APPS_SCRIPT_WEB_APP_URL, {
                        method: 'POST',
                        mode: 'no-cors', // Required for Google Apps Script Web App
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                    });

                    // Since mode: 'no-cors' is used, we cannot read the response directly.
                    // Assume success if no network error. A more robust solution would involve
                    // a CORS-enabled endpoint or a different approach for feedback.
                    showMessage('Data submitted successfully! Check your Google Sheet.', 'success');
                    form.reset(); // Clear the form on successful submission
                    paymentsCheckbox.checked = false; // Ensure checkboxes are reset
                    refundsCheckbox.checked = false;
                } catch (error) {
                    console.error('Error submitting data:', error);
                    showMessage('Error submitting data. Please try again.', 'error');
                } finally {
                    document.getElementById('saveButton').textContent = 'Save';
                    document.getElementById('saveButton').disabled = false;
                }
            });

            // Handle clear button click
            clearButton.addEventListener('click', () => {
                form.reset(); // Resets all form fields
                paymentsCheckbox.checked = false; // Ensure checkboxes are reset
                refundsCheckbox.checked = false;
                showMessage('Form cleared.', 'success');
            });
        });
    </script>
</body>
</html>
